trigger:
- main

pool:
  vmImage: 'windows-latest'

jobs:
- job: LevantarFrontend
  displayName: 'Levantar Frontend'
  steps:
  - task: UseNode@1
    inputs:
      version: '14.x'
      checkLatest: true
  - script: |
      cd C:\Users\MoisesC\Desktop\Adop Masc con graph\front
      npm install -g pm2
      pm2 start npm --name "frontend" -- start --no-daemon
      wait -t 0
    displayName: 'Levantar Frontend'

- job: LevantarBackend
  displayName: 'Levantar Backend'
  dependsOn: LevantarFrontend
  steps:
  - task: UseNode@1
    inputs:
      version: '14.x'
      checkLatest: true
  - script: |
      cd C:\Users\MoisesC\Desktop\Adop Masc con graph\backend
      npm install -g pm2
      pm2 start npm --name "backend" -- start --no-daemon
      wait -t 0
    displayName: 'Levantar Backend'

- job: LevantarAdmin
  displayName: 'Levantar Admin'
  dependsOn: LevantarBackend
  steps:
  - task: UseNode@1
    inputs:
      version: '14.x'
      checkLatest: true
  - script: |
      cd C:\Users\MoisesC\Desktop\Adop Masc con graph\admin
      npm install -g pm2
      pm2 start npm --name "admin" -- start --no-daemon
      wait -t 0
    displayName: 'Levantar Admin'

- job: EjecutarPruebas
  displayName: 'Ejecutar Pruebas Selenium con Maven'
  dependsOn: 
    - LevantarFrontend
    - LevantarBackend
    - LevantarAdmin
  steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'C:\Users\MoisesC\Desktop\ProyFinalDipAutomation\pom.xml'
      mavenOptions: '-Xmx3072m'
      goals: 'clean test'
    displayName: 'Ejecutar Pruebas Selenium con Maven'

- job: DetenerServicios
  displayName: 'Detener Servicios'
  dependsOn: EjecutarPruebas
  steps:
  - script: |
      pm2 stop all
      pm2 delete all
    displayName: 'Detener todos los servicios'
