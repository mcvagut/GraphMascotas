trigger:
- main

pool: proyecto

jobs:
- job: LevantarServicios
  displayName: 'Levantar Servicios'
  steps:
  - task: UseNode@1
    inputs:
      version: '14.x'
      checkLatest: true
  - script: 'start /B cmd /C "npm start" & echo %time% > start_time.txt'
    displayName: 'Levantar Frontend'
    workingDirectory: 'C:\Users\MoisesC\Desktop\Adop Masc con graph\front'
  - script: 'start /B cmd /C "npm start" & echo %time% > start_time.txt'
    displayName: 'Levantar Backend'
    workingDirectory: 'C:\Users\MoisesC\Desktop\Adop Masc con graph\backend'
  - script: 'start /B cmd /C "npm start" & echo %time% > start_time.txt'
    displayName: 'Levantar Admin'
    workingDirectory: 'C:\Users\MoisesC\Desktop\Adop Masc con graph\admin'
  - script: 'timeout /t 60 /nobreak'
    displayName: 'Esperar que los servicios se inicien'

- job: EjecutarPruebas
  displayName: 'Ejecutar Pruebas Selenium con Maven'
  dependsOn: LevantarServicios
  steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'C:\Users\MoisesC\Desktop\ProyFinalDipAutomation\pom.xml'
      mavenOptions: '-Xmx3072m'
      goals: 'clean test'
    displayName: 'Ejecutar Pruebas Selenium con Maven'

- job: DetenerServicios
  displayName: 'Detener Servicios'
  dependsOn: EjecutarPruebas
  steps:
  - script: 'taskkill /IM node.exe /F'
    displayName: 'Detener todos los servicios'
